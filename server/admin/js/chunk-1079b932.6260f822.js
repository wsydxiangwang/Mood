(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1079b932"],{"41c6":function(t,a,e){},"55f0":function(t,a,e){"use strict";var i=e("41c6"),s=e.n(i);s.a},e12b:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy/MM/dd HH:mm",placeholder:"选择日期时间"},model:{value:t.value,callback:function(a){t.value=a},expression:"value"}})},s=[],l={props:["originalDate"],data(){return{value:""}},watch:{value(t){this.$emit("getDate",t)}},mounted(){this.originalDate&&"{}"!=JSON.stringify(this.originalDate)&&(this.value=this.originalDate)}},o=l,d=e("2877"),n=Object(d["a"])(o,i,s,!1,null,null,null);a["a"]=n.exports},f7ff:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"article-new"},[e("section",[e("h2",{staticClass:"tit"},[t._v("无人问津的心情，在黑纸白字间游荡！")]),e("el-input",{attrs:{placeholder:"标题",clearable:""},model:{value:t.data.title,callback:function(a){t.$set(t.data,"title",a)},expression:"data.title"}})],1),e("mavon-editor",{ref:"md",attrs:{ishljs:!0,subfield:!1},on:{change:t.change,imgAdd:t.$imgAdd,imgDel:t.$imgDel},model:{value:t.data.content,callback:function(a){t.$set(t.data,"content",a)},expression:"data.content"}}),e("section",[t.isReset?e("date",{attrs:{originalDate:t.data.time},on:{getDate:t.getDate}}):t._e(),e("el-input",{attrs:{placeholder:"文章摘要","prefix-icon":"el-icon-document",clearable:""},model:{value:t.data.describe,callback:function(a){t.$set(t.data,"describe",a)},expression:"data.describe"}}),t.uploadToggle?[e("el-input",{attrs:{placeholder:"音乐地址","prefix-icon":"el-icon-headset",clearable:""},model:{value:t.data.music.url,callback:function(a){t.$set(t.data.music,"url",a)},expression:"data.music.url"}}),e("el-input",{attrs:{placeholder:"封面图片","prefix-icon":"el-icon-picture-outline-round",clearable:""},model:{value:t.data.image.url,callback:function(a){t.$set(t.data.image,"url",a)},expression:"data.image.url"}})]:e("div",{staticClass:"upload-box"},[e("el-upload",{staticClass:"upload-demo",attrs:{"auto-upload":!1,"show-file-list":!1,"on-change":t.musicUpload,action:"",drag:""}},[t.data.music&&t.data.music.url?[e("i",{staticClass:"el-icon-headset"}),e("div",{staticClass:"el-upload__text"},[t._v(t._s(t.data["music"].name))])]:[e("i",{staticClass:"el-icon-headset"}),e("div",{staticClass:"el-upload__text"},[t._v("背景音乐")])]],2),e("el-upload",{staticClass:"upload-demo",attrs:{"auto-upload":!1,"show-file-list":!1,"on-change":t.imgUpload,action:"",drag:""}},[t.data.image&&t.data.image.url?e("img",{attrs:{src:t.data.image.url}}):t._e(),e("i",{staticClass:"el-icon-picture-outline-round"}),e("div",{staticClass:"el-upload__text"},[t._v("封面图片 (680*440)")])])],1),e("el-switch",{attrs:{"active-text":"输入链接","inactive-text":"文件上传"},model:{value:t.uploadToggle,callback:function(a){t.uploadToggle=a},expression:"uploadToggle"}}),e("el-switch",{attrs:{"inactive-text":"发布文章","active-text":"隐藏文章"},model:{value:t.data.hide,callback:function(a){t.$set(t.data,"hide",a)},expression:"data.hide"}})],2),e("el-button",{staticClass:"submit",attrs:{type:"primary"},on:{click:t.submit}},[t._v("SUBMIT")])],1)},s=[],l=e("e12b"),o=e("2f62"),d=e("b2d8"),n=(e("64e1"),{components:{date:l["a"],mavonEditor:d["mavonEditor"]},data(){return{data:{title:"",content:"",contentHtml:"",describe:"",time:"",image:{},music:{},hide:!1},isReset:!0,id:"",upload:{},uploadToggle:!1,fullscreenLoading:!1,loading:""}},created(){this.id=this.$route.query.id,this.id&&this.loadData(this.id)},watch:{"data.image.url":{handler(t){t||delete this.upload["image"]}},"data.music.url":{handler(t){t||delete this.upload["music"]}}},computed:{...Object(o["b"])(["$data"])},methods:{musicUpload(t){this.uploads("music",t)},imgUpload(t){this.uploads("image",t)},uploads(t,a){const e="music"==t?"audio":"image";if(!a.raw.type.includes(e))return void this.$message.error(`请选择${e}格式的文件!`);const i=new FormData;i.append("file",a.raw),i.append("type",this.$data.info.upload_type),this.$set(this.data,t,{url:URL.createObjectURL(a.raw),name:a.name}),this.$set(this.upload,t,{url:URL.createObjectURL(a.raw),name:a.name,formData:i})},$imgAdd(t,a){var e=new FormData;e.append("file",a),e.append("type",this.$data.info.upload_type),this.$http.post("/upload",e).then(a=>{this.$refs.md.$img2Url(t,a.data.url)})},$imgDel(t){const a={url:t[0],type:this.$data.info.upload_type};this.$http.post("/delete_file",a)},change(t,a){this.data.contentHtml=a,this.data.content=t,this.data.words=t.length},async submit(){const t={title:"请输入标题",content:"请输入内容",time:"请选择时间"};for(let s in t)if(!this.data[s])return void this.$message.error(`${t[s]}`);if(this.fullscreenLoading=!0,!this.uploadToggle)for(let s in this.upload){const t=await this.$http.post("/upload",this.upload[s].formData);100==t.data.status?this.data[s].url=t.data.url:(this.$message.error("图片上传失败, 请检查网络!"),this.fullscreenLoading=!1)}const a=this.data.describe;this.data.describe=a||this.data.content.slice(0,60)+"...";const e=this.id?`article/${this.data._id}`:"article",i=this.id?"更新":"发表";this.$http.post(e,this.data).then(t=>{setTimeout(()=>{1===t.data.status?(this.$message({message:`${i}成功`,type:"success"}),this.$router.push("/article"),this.$infoUpdate()):this.$message.error(`${i}失败，请检查网络问题!`),this.fullscreenLoading=!1},500)})},getDate(t){this.data.time=t},async loadData(t){this.loading=this.$loading({target:".container"});const a=await this.$http.get(`article/${t}`);setTimeout(()=>{this.data=a.data.body,this.isReset=!1,this.$nextTick(()=>{this.isReset=!0}),this.loading.close()},500)}}}),c=n,r=(e("55f0"),e("2877")),u=Object(r["a"])(c,i,s,!1,null,"49747257",null);a["default"]=u.exports}}]);
//# sourceMappingURL=chunk-1079b932.6260f822.js.map