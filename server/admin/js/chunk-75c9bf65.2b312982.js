(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75c9bf65"],{"4b5b":function(e,t,a){},"535e":function(e,t,a){"use strict";var s=a("4b5b"),o=a.n(s);o.a},"79d9":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}]},[e._m(0),s("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[e._l(e.formList[0],(function(t,a){return[t.show?e._e():s("el-form-item",{key:a,attrs:{label:t.value}},["avatar"==t.key?[s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","auto-upload":!1,"show-file-list":!1,"on-change":e.avatarUpload}},[e.avatar["url"]||e.form.avatar?s("img",{attrs:{src:e.avatar["url"]||e.form.avatar}}):s("i",{staticClass:"el-icon-user"})])]:"upload_type"==t.key?[s("el-radio-group",{model:{value:e.form.upload_type,callback:function(t){e.$set(e.form,"upload_type",t)},expression:"form.upload_type"}},[s("el-radio",{attrs:{label:"服务器"}}),s("el-radio",{attrs:{label:"阿里云OSS"}})],1),"阿里云OSS"==e.form.upload_type?[e._l(e.formList[2],(function(t,a){return[s("el-input",{key:a,staticStyle:{"margin-top":"10px"},attrs:{placeholder:"domain"==t?"自定义图片域名, 需解析至oss (http://img.baidu.com)":t},model:{value:e.form["upload_oss"][t],callback:function(a){e.$set(e.form["upload_oss"],t,a)},expression:"form['upload_oss'][item]"}})]}))]:e._e()]:"email_message"==t.key?[s("el-switch",{on:{change:e.emailChange},model:{value:e.form.email_message,callback:function(t){e.$set(e.form,"email_message",t)},expression:"form.email_message"}})]:[s("el-input",{attrs:{placeholder:t.placeholder},model:{value:e.form[t.key],callback:function(a){e.$set(e.form,t.key,a)},expression:"form[item.key]"}})]],2)]})),s("h2",{staticClass:"tit hint-tit"},[e._v("首屏效果 "),s("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[s("p",[e._v("背景颜色请选择类似图片颜色的透明度")]),s("img",{attrs:{src:a("f5a3")}}),s("span",{attrs:{slot:"reference"},slot:"reference"},[e._v("(view)")])])],1),e._l(e.formList[1],(function(t,a,o){return[s("el-form-item",{key:o+22,attrs:{label:t}},["image"==a?[s("el-upload",{staticClass:"cover",attrs:{action:"","auto-upload":!1,"show-file-list":!1,"on-change":e.coverUpload}},[e.cover["url"]||e.form.cover["image"]?s("img",{attrs:{src:e.cover["url"]||e.form.cover["image"]}}):s("i",{staticClass:"el-icon-plus"})]),s("span",{staticClass:"upload-image-size"},[e._v("(1920*1080)")])]:"link"==a?[s("el-input",{attrs:{placeholder:"填写文章ID"},model:{value:e.form["cover"][a],callback:function(t){e.$set(e.form["cover"],a,t)},expression:"form['cover'][k]"}})]:"color"==a?[s("el-color-picker",{attrs:{"show-alpha":""},model:{value:e.form["cover"]["color"],callback:function(t){e.$set(e.form["cover"],"color",t)},expression:"form['cover']['color']"}})]:"icp_txt"==a||"icp_link"==a?[s("el-input",{attrs:{placeholder:"网站的备案信息, 有则填写"},model:{value:e.form["cover"][a],callback:function(t){e.$set(e.form["cover"],a,t)},expression:"form['cover'][k]"}})]:[s("el-input",{model:{value:e.form["cover"][a],callback:function(t){e.$set(e.form["cover"],a,t)},expression:"form['cover'][k]"}})]],2)]})),s("h2",{staticClass:"tit"},[e._v("页面音乐")]),e._l(e.formList[3],(function(t,a,o){return[s("el-form-item",{key:o+222,attrs:{label:t}},[s("el-input",{attrs:{placeholder:"填写音乐链接地址"},model:{value:e.form["bg"][a],callback:function(t){e.$set(e.form["bg"],a,t)},expression:"form['bg'][k]"}})],1)]})),s("h2",{staticClass:"tit"},[e._v("修改密码")]),s("el-form-item",{attrs:{label:"原密码"}},[s("el-input",{model:{value:e.password.one,callback:function(t){e.$set(e.password,"one",t)},expression:"password.one"}})],1),s("el-form-item",{attrs:{label:"新密码"}},[s("el-input",{model:{value:e.password.two,callback:function(t){e.$set(e.password,"two",t)},expression:"password.two"}})],1),s("el-form-item",[s("el-button",{staticClass:"submit",attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即保存")]),s("span",{staticClass:"hint"},[s("i",{staticClass:"el-icon-warning"}),e._v("信息需填写完整才能正常使用")])],1)],2)],1)},o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header"},[a("h2",{staticClass:"tit"},[e._v("网站信息")])])}],r=a("2f62"),l={data(){return{avatar:{},cover:{},formList:[[{key:"avatar",value:"管理员头像"},{key:"name",value:"管理员昵称"},{key:"comment_mark",value:"管理员标识"},{key:"web_name",value:"网站昵称"},{key:"web_describe",value:"网站描述"},{key:"address",value:"网站地址"},{key:"email",value:"评论邮箱"},{key:"email_name",value:"评论昵称"},{key:"upload_type",value:"文件上传"},{key:"email_message",value:"评论通知"},{key:"email_pass",value:"邮箱PASS",placeholder:"与评论邮箱一致的PASS, 只支持QQ邮箱",show:!0}],{image:"封面图",title:"标题",describe:"描述",date:"时间",link:"链接",color:"色调",icp_txt:"备案号",icp_link:"备案链接"},["bucket","region","endPoint","accessKeySecret","accessKeyId","domain"],{bg_mood:"文章列表",bg_letter:"短语列表",bg_about:"个人介绍"}],form:{cover:{},upload_oss:{},upload_type:"服务器",bg:{}},fullscreenLoading:!1,password:{}}},mounted(){Object.keys(this.$info).length>0&&this.update()},watch:{$info(){this.update()}},computed:{...Object(r["b"])(["$data"]),$info(){return Object.keys(this.$data).length>0?this.$data.info:{}}},methods:{update(){for(let e in this.$info)this.$set(this.form,e,this.$info[e]);this.$set(this.formList[0][10],"show",!this.$info["email_message"])},async onSubmit(){if(Object.keys(this.password).length>0){if(!this.password["one"])return void this.$message.error("请输入原密码!");if(!this.password["two"])return void this.$message.error("请填写新密码!");this.fullscreenLoading=!0;const e=await this.$http.post("/password",{password:this.password});if(2===e.data.status)return this.fullscreenLoading=!1,void this.$message.error("原密码输入有误!")}this.fullscreenLoading=!0;const e=["avatar","cover"],t=e.reduce((e,t)=>{return this[t].url&&e.push(new Promise((e,a)=>{this[t]["formData"].append("type",this.form.upload_type),this[t]["formData"].append("upload_oss",JSON.stringify(this.form.upload_oss)),this.$http.post("/upload",this[t].formData).then(s=>{100==s.data.status?(this[t]={},e({type:t,url:s.data.url})):a()}).catch(e=>{a(e)})})),e},[]);Promise.all(t).then(e=>{e.length>0&&e.map(e=>{"avatar"===e.type?this.form["avatar"]=e.url:this.form.cover["image"]=e.url}),this.$http.post("/info",this.form).then(e=>{1===e.data.status&&setTimeout(()=>{this.$message({message:"更新成功",type:"success"}),this.$store.commit("updataInfo",e.data.body),this.fullscreenLoading=!1,this.$router.push("/")},500)})}).catch(e=>{this.fullscreenLoading=!1,this.$message.error("图片上传失败，请检查网络是否正常 or OSS信息是否填写正确!")})},emailChange(e){this.formList[0][10].show=!e},upload(e,t){if(!t.raw.type.includes("image"))return void this.$message.error("请选择图片格式的文件!");const a=new FormData;a.append("file",t.raw),this[e]={url:URL.createObjectURL(t.raw),formData:a},"avatar"===e?this.form["avatar"]=URL.createObjectURL(t.raw):this.form["cover"]["image"]=URL.createObjectURL(t.raw)},avatarUpload(e){this.upload("avatar",e)},coverUpload(e){this.upload("cover",e)}}},i=l,n=(a("535e"),a("2877")),c=Object(n["a"])(i,s,o,!1,null,"6ddb70d5",null);t["default"]=c.exports},f5a3:function(e,t,a){e.exports=a.p+"img/cover.b5d33f25.png"}}]);
//# sourceMappingURL=chunk-75c9bf65.2b312982.js.map